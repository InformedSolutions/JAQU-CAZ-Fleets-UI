- title_content = 'Manage your vehicles and view charges'
- title_and_header = flash[:success] ? "Upload successful - #{title_content}" : title_content
- content_for(:title, title_and_header)

= back_link_to_dashboard

%main.govuk-main-wrapper#main-content{role: 'main'}
  .govuk-grid-row
    .govuk-grid-column-full
      - if alert
        = render 'shared/error_summary',
                  error_msg_div: '#confirm-vehicle-creation-error',
                  error_msg: alert

      = render 'shared/banners'

      %h1.govuk-heading-l
        = title_content
      %p
        Charge information for your vehicles in each Clean Air Zone.
      .govuk-inset-text
        %b Live
        \- you must pay a charge to drive in the zone
        %br
        %b Upcoming
        \- you do not need to pay until charging starts, you can see the dates on our
        = external_link_to('guidance page',
                           'https://www.gov.uk/guidance/driving-in-a-clean-air-zone#cleanairzones',
                           class: 'govuk-link')

      %table.govuk-table
        %caption.govuk-table__caption
        %thead.govuk-table__head
          %tr.govuk-table__row
            %th.govuk-table__header{scope: 'col', class: 'vehicle-management-column'} Number plate
            %th.govuk-table__header{scope: 'col', class: 'vehicle-management-column'} Type
            - @zones.each do |zone|
              %th.govuk-table__header{scope: 'col', class: 'vehicle-management-column'}
                = zone.name
                %br
                = zone.live? ? '(Live)' : '(Upcoming)'
            %th.govuk-table__header{scope: 'col'}
              .govuk-visually-hidden Actions
        %tbody.govuk-table__body
          - @pagination.vehicle_list.each do |vehicle|
            %tr.govuk-table__row
              %td.govuk-table__cell{scope: 'row', class: 'vehicle-management-column'}
                = vehicle.vrn
              %td.govuk-table__cell{scope: 'row', class: 'vehicle-management-column'}
                = vehicle.type
              - @zones.each do |zone|
                %td.govuk-table__cell{scope: 'row', class: 'vehicle-management-column'}
                  = vehicle.formatted_charge(zone.id)
              %td.govuk-table__cell{scope: 'row'}
                = link_to('Remove', assign_delete_fleets_path(vrn: vehicle.vrn))
      = render 'pagination'

      %h2.govuk-heading-m Add vehicles
      %p
        You can add multiple vehicles by overriding this list with a new
        = succeed '.' do
          = link_to('list of vehicles', uploads_path, id: 'reupload', class: 'govuk-link')
      
      %p
        = succeed '.' do
          = link_to('Add individual vehicles one by one',
                    enter_details_vehicles_path,
                    id: 'individual-payment',
                    class: 'govuk-link')
      
      - if allow_make_payments? && @pagination.total_vehicles_count >= 2
        %hr.govuk-section-break.govuk-section-break--m
        = link_to('Make a payment', payments_path, id: 'payment-button', class: 'govuk-button', 'data-module': 'govuk-button')
      
      %p
        = link_to('Return to Your account', dashboard_path, id: 'individual-payment', class: 'govuk-link')
